<body>
<script>
  var currentAudio = new Audio();
  function muteAndPlay(music) {
    var thisAudio = new Audio(music);
    thisAudio.load()
    thisAudio.loop = true;
    // mute the old music
    currentAudio.pause();
    // play the new music
    thisAudio.play();
    currentAudio = thisAudio;  
  }
  function mute() {
    currentAudio.pause();
  }
</script>

{{init}}

{{#each tiles}}
  {{> title}}
  {{> sound}}
  {{music}}
  {{> picture}}
  {{> story}}
  {{> stuff}}
{{else}}
  <h1>UNDER CONSTRUCTION</h1>
  <p>Looks like this tile has not been implemented. You can reload this page to restart from the beginning</p>
{{/each}}
</body>

<template name="title">
  <header>
    <h1 align="center">{{title}}</h1>
  </header>
</template>

<template name="picture">
  <div align="center" style="border:3px solid black">
<!--     If we have a video available, we play it. If not, we display a picture instead. -->
  {{#if video}}
    <video height="300px" controls autoplay>
      <source src={{video}} type="video/webm"/>
    </video>
  {{else}}
    {{#if map}}
      <!--     If we have a picture map, we add it here -->
      <img src="{{picture}}" height="300px" usemap="#{{id}}"/>
      {{> maps}}
    {{else}}
      <img src="{{picture}}" height="300px"/>
    {{/if}}
  {{/if}}
  </div>
</template>

<template name="maps">
  <map name={{id}}>
    {{#each map}}
      {{> map}}
    {{/each}}
  </map>
</template>

<template name="map">
  <area shape="{{shape}}" coords="{{coords}}" tile={{to_tile}} item={{item}} uses={{uses}} />
</template>

<template name="story">
  <div style="border:3px solid black">
  {{> text}}
  
  <ul>
  {{#each choices}}
    {{> choice}}
  {{/each}}
  </ul>

  </div>
</template>

<template name="text">
<p>{{{text}}}</p>
</template>

<template name="choice">
  {{#if enabled}}
    <li><button tile="{{to_tile}}" item="{{item}}" uses="{{uses}}">{{text}}</button></li>
  {{else}}
    <li><button disabled>{{text}}</button></li>
  {{/if}}
</template>

<template name="stuff">
  <div style="border:3px solid black">
  <h3>My Stuff</h3>
  <ul>
  {{#each stuff}}
    {{> item}}
  {{/each}}
  </ul>
  </div>
</template>

<template name="item">
    <li>{{name}} ({{description}})</li>
</template>

<template name="sound">
  <div hidden>
  <audio controls autoplay>
    <source src="{{sound}}" type="audio/mpeg">
  </audio>
  </div>
</template>

